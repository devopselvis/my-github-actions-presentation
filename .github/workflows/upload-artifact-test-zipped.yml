# Workflow to test upload-artifact action with 501 files zipped into a single file
# This tests the 500 file limit mentioned in https://github.com/actions/upload-artifact

name: Upload Artifact Test - Zipped Upload

# Controls when the action will run. Workflow runs when manually triggered using the UI or API.
on:
  workflow_dispatch:

jobs:
  test-zipped-upload:
    name: Test uploading 501 files as a single zip file
    runs-on: ubuntu-latest

    steps:
      - name: Create 501 test files
        run: |
          mkdir -p test-files
          for i in {1..501}; do
            echo "This is test file number $i" > test-files/file-$i.txt
          done
          echo "Created $(ls test-files | wc -l) files"

      - name: Zip all files
        run: |
          zip -r test-files.zip test-files/
          echo "Zip file created: $(ls -lh test-files.zip)"

      - name: Upload zip file
        uses: actions/upload-artifact@v4
        with:
          name: test-501-files-zipped
          path: test-files.zip
